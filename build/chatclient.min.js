/*! pa2 2014-02-22 */
angular.module("ChatApp",["ng","ngRoute"]),angular.module("ChatApp").constant("SOCKET_URL","http://localhost:8080"),angular.module("ChatApp").factory("SocketService",["$http",function(){var a,b="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},getUsername:function(){return b},getSocket:function(){return a}}}]),angular.module("ChatApp").controller("LoginCtrl",["$scope","SOCKET_URL","$location","SocketService",function(a,b,c,d){var e=io.connect(b);a.username="",a.message="",a.connect=function(){e&&e.emit("adduser",a.username,function(b){b?(d.setConnected(e),d.setUsername(a.username),c.path("/roomList")):a.message="Your name is taken, please choose another",a.$apply()})}}]),angular.module("ChatApp").config(function(a){a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/roomList",{templateUrl:"views/roomList.html",controller:"RoomListCtrl"}).when("/room/:roomName",{templateUrl:"views/room.html",controller:"RoomCtrl"}).otherwise({redirectTo:"/index"})}),angular.module("ChatApp").controller("RoomCtrl",["$scope","$routeParams","$location","SocketService",function(a,b,c,d){a.roomName=b.roomName,a.currentMessage="",a.userInRoom=d.getUsername(),a.alerts=[],a.poppUpMessage="",a.privateMsgUser="",a.users=[],a.showBanKick=!1;var e=d.getSocket();$("#chatMessage").hide(),e&&(""!==a.roomName&&e.emit("joinroom",{room:a.roomName,pass:""},function(b){b===!1&&(a.message="You could not join this chat room!"),a.$apply(),console.log(""),console.log(a.showBanKick)}),e.on("updatechat",function(b,c){a.messages=c,a.$apply()}),e.on("updateusers",function(b,c,e){b===a.roomName&&(a.users=c,a.showBanKick=void 0!==e&&e[d.getUsername()]===d.getUsername()?!0:!1,a.$apply(),console.log(""),console.log(a.showBanKick))}),e.on("recv_privatemsg",function(b,c){a.alerts.push({msg:c,usr:b}),a.$apply()}),e.on("kicked",function(b,e,f){d.getUsername()===e?(a.poppUpMessage="You have been kicked from this chat by "+f+"!",c.path("/roomList")):a.poppUpMessage=e+" has been kicked from the chat room by"+f+"!",a.$apply(),$("#chatMessage").show(),$("#chatMessage").fadeOut(4e3)}),e.on("banned",function(b,e,f){d.getUsername()===e?(a.poppUpMessage="You have been banned from this chat by "+f+"!",c.path("/roomList"),c.path("/roomList")):a.poppUpMessage=e+" has been banned from the chat room by"+f+"!",a.$apply(),$("#chatMessage").show(),$("#chatMessage").fadeOut(4e3)}),e.on("servermessage",function(b,c,e){d.getUsername()!==e&&("join"===b?a.poppUpMessage=e+" has joined the chat room!":"part"===b?a.poppUpMessage=e+" has left the chat room!":"quit"===b&&(a.poppUpMessage=e+" has left the chat!"),a.$apply(),$("#chatMessage").show(),$("#chatMessage").fadeOut(4e3))})),a.closeAlert=function(b){a.alerts.splice(b,1)},a.send=function(){e&&(e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage}),a.currentMessage="")},a.keyPress=function(b){13===b.keyCode&&a.send()},a.setPrivateMsgUser=function(b){e&&(a.privateMsgUser=b)},a.sendPrivateMessage=function(){e&&(e.emit("privatemsg",{nick:a.privateMsgUser,message:a.privateMessage},function(b){b===!1&&(a.message="Not possible to send private message!")}),a.privateMsgUser="",$("#privateMsgModal").modal("hide"))},a.leaveRoom=function(){e&&(e.emit("partroom",a.roomName),c.path("/roomList"))},a.kickUser=function(b){e&&e.emit("kick",{user:b,room:a.roomName},function(b){b===!1&&(a.message="You cannot kick this user from the chat room!")})},a.banUser=function(b){e&&e.emit("ban",{user:b,room:a.roomName},function(b){b===!1&&(a.message="You cannot ban this user for the chat room!")})}}]),angular.module("ChatApp").controller("RoomListCtrl",["$scope","SOCKET_URL","$location","SocketService",function(a,b,c){var d=io.connect(b);a.username="",a.message="",d?(d.emit("rooms"),d.on("roomlist",function(b){a.roomList=[],a.rooms=b,a.$apply()})):c.path("/"),a.createNewRoom=function(){d&&(d.emit("joinroom",{room:a.newChatName,pass:""},function(b,c){b===!1&&(a.message=c)}),d.emit("settopic",{room:a.newChatName,topic:a.newChatName},function(b,c){b===!1&&(a.message=c)}),d.emit("rooms"))},a.logOut=function(){d&&(d.emit("disconnect"),console.log("logOut"),c.path("/"))}}]);